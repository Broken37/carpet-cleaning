{% extends "base.html" %}

{% block content %}
<table class="table table-striped table-hover mb-0 align-middle table-dark">
    <thead>
        <tr>
            <th><i class='fad fa-bars me-2'></i>Name : <input type="text" class="form-control" aria-label="Small"
                    aria-describedby="inputGroup-sizing-sm" id="name-filter" value="{{ name_filter }}"></th>
            <th>
                <i class='fad fa-clock me-2'></i>Time : <select class="form-select" aria-label="Default select example"
                    id="open-status">
                    <option value="none">--</option>
                    <option value="open">Open</option>
                    <option value="close">Close</option>
                </select>
            </th>
            <th>
                <button class='btn btn-outline-primary' onclick="myFunction()">Filter</button>
            </th>
        </tr>
    </thead>
</table>

<table class="table table-striped table-hover mb-0 align-middle table-dark">
    <thead>
        <tr>
            <th><i class='fad fa-bars me-2'></i>Name : <input type="text" id="name-filter" style="width: 140px"
                    value="{{ name_filter }}"></th>
            <th>
                <button onclick="myFunction()">Filter</button>
            </th>
        </tr>
    </thead>
</table>
<table class="table table-striped table-hover mb-0 align-middle table-dark">

    <thead>
        <tr>
            <th><i class='fad fa-bars me-2'></i>Carpet Cleaning</th>
            <th><i class='fad fa-user-shield me-2'></i>Owner</th>
            <th><i class='fad fa-clock me-2'></i>Opens at</th>
            <th><i class='fad fa-clock me-2'></i>Closes at</th>
            <th><i class='fad fa-map-marked me-2'></i>Address</th>
            <th><i class='fad fa-dollar-sign me-2'></i>Delivery Cost</th>
            <th><i class='fad fa-cogs me-2'></i>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for carpetcleaning in carpetcleanings %}
        <tr>
            <td>{{ carpetcleaning.name }}</td>
            <td>{{ carpetcleaning.owner }}</td>
            <td>{{ carpetcleaning.opens_at }}</td>
            <td>{{ carpetcleaning.closes_at }}</td>
            <td>{{ carpetcleaning.address }}</td>
            <td>{{ carpetcleaning.delivery_cost }}</td>
            <td><a href="{% url 'register_page' carpetcleaning.id %}" class='btn btn-outline-primary'>Order</a></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>

    var open_status_input = "{{ open_status }}"
    var open_status = document.getElementById('open-status');
    if (open_status_input === 'open') {
        open_status.selectedIndex = 1
    } else if (open_status_input === 'close') {
        open_status.selectedIndex = 2
    }

    function myFunction() {
        const urlParams = new URLSearchParams(window.location.search);
        var name_filter = document.getElementById('name-filter').value;
        var open_status = document.getElementById('open-status').value;
        if (name_filter !== '') {
            urlParams.set('name', name_filter);
        } else {
            urlParams.delete('name')
        }
        urlParams.set('open_status', open_status);

        window.location.search = urlParams;
    }

</script>
{% endblock %}